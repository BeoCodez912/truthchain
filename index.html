<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TruthChain + TON Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
  <script src="https://unpkg.com/@tonconnect/sdk@2.0.0/dist/tonconnect.umd.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #eee; text-align: center; padding: 20px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; border-radius: 8px; border: none; }
    #multiplierBar { width: 100%; height: 30px; background: #333; margin: 20px 0; border-radius: 15px; overflow: hidden; }
    #multiplierFill { height: 100%; width: 1%; background: limegreen; text-align: center; color: black; line-height: 30px; }
  </style>
</head>
<body>
  <h1>TruthChain â€” TON Blockchain</h1>

  <button id="connectWallet">Connect TON Wallet</button>
  <button id="sendTon" disabled>Send TON</button>
  <button id="addBlock" disabled>Add Block</button>
  <button id="withdrawMining" disabled>Withdraw Mining</button>
  <button id="depositSymbolic" disabled>Deposit Symbolic (x2)</button>

  <div id="multiplierBar">
    <div id="multiplierFill">x1</div>
  </div>

  <h3>Referral System</h3>
  <input type="text" id="refInput" placeholder="Enter your referral code" />
  <button id="genReferral" disabled>Generate Referral</button>
  <p id="referralLink"></p>

  <pre id="log"></pre>

<script>
/* ----------------- Blockchain ----------------- */
class Block {
  constructor(index, timestamp, data, previousHash = '') {
    this.index = index;
    this.timestamp = timestamp;
    this.data = data;
    this.previousHash = previousHash;
    this.nonce = 0;
    this.hash = this.calculateHash();
  }
  calculateHash() {
    return CryptoJS.SHA256(this.index + this.timestamp + JSON.stringify(this.data) + this.previousHash + this.nonce).toString();
  }
}

class Blockchain {
  #chain;
  #difficulty;
  constructor(difficulty = 3) {
    this.#chain = [this.createGenesisBlock()];
    this.#difficulty = difficulty;
  }
  createGenesisBlock() {
    return new Block(0, new Date().toISOString(), { genesis: true }, '0'.repeat(64));
  }
  get chain() { return [...this.#chain]; }
  get latest() { return this.#chain[this.#chain.length - 1]; }
  get difficulty() { return this.#difficulty; }
  addBlock(data) {
    const prevHash = this.latest.hash;
    const index = this.#chain.length;
    const timestamp = new Date().toISOString();
    let nonce = 0, hash = '', prefix = '0'.repeat(this.#difficulty);
    do {
      hash = CryptoJS.SHA256(index + timestamp + JSON.stringify(data) + prevHash + nonce).toString();
      nonce++;
    } while (!hash.startsWith(prefix));
    const b = new Block(index, timestamp, data, prevHash);
    b.hash = hash; b.nonce = nonce;
    this.#chain.push(b);
    return b;
  }
}

/* ----------------- State ----------------- */
const truthChain = new Blockchain(3);
let miningValue = 0;
let multiplier = 1;
let walletConnected = false;
let recipient = "UQ...replace_with_valid_ton_address";

/* Private blessings */
const hidden = { Name: "Truth", Hope: "Light", Friend: "Forever" };
console.log(hidden.Name, hidden.Hope, hidden.Friend);

/* ----------------- TON Wallet ----------------- */
const tonConnect = new TON_CONNECT.TonConnect({ manifestUrl: window.location.origin + "/tonconnect-manifest.json" });

async function connectWallet() {
  try {
    await tonConnect.connect();
    walletConnected = true;
    log("Wallet connected.");
    enableButtons();
  } catch (e) { log("Wallet connection failed: " + e); }
}

/* ----------------- Buttons ----------------- */
function enableButtons() {
  document.querySelectorAll("button").forEach(btn => {
    if (btn.id !== "connectWallet") btn.disabled = false;
  });
}

document.getElementById("connectWallet").onclick = connectWallet;

document.getElementById("sendTon").onclick = () => {
  if (!walletConnected) return log("Connect wallet first.");
  log("Sending TON to " + recipient);
};

document.getElementById("addBlock").onclick = () => {
  if (!walletConnected) return log("Connect wallet first.");
  const blk = truthChain.addBlock({ reward: miningValue });
  miningValue += 1 * multiplier;
  log("Block added: " + JSON.stringify(blk, null, 2));
};

document.getElementById("withdrawMining").onclick = () => {
  if (!walletConnected) return log("Connect wallet first.");
  log("Withdrawing " + miningValue + " mining rewards.");
  miningValue = 0;
};

document.getElementById("depositSymbolic").onclick = () => {
  if (!walletConnected) return log("Connect wallet first.");
  multiplier *= 2;
  updateMultiplier();
  log("Symbolic deposit made. Multiplier is now x" + multiplier);
};

document.getElementById("genReferral").onclick = () => {
  const refInput = document.getElementById("refInput").value || "default";
  const link = `https://earnfromplay.blogspot.com/2025/08/ton-kid-jon.html&referral=${refInput}`;
  document.getElementById("referralLink").innerText = link;
  log("Referral link generated: " + link);
};

/* ----------------- UI Helpers ----------------- */
function updateMultiplier() {
  const bar = document.getElementById("multiplierFill");
  const pct = Math.min(multiplier * 10, 100);
  bar.style.width = pct + "%";
  bar.innerText = "x" + multiplier;
}

function log(msg) {
  document.getElementById("log").textContent += msg + "\n";
}

/* ----------------- unknownTruth ----------------- */
function unknownTruth(seed) {
  const value = CryptoJS.SHA256(seed + Date.now()).toString();
  log("unknownTruth revealed: " + value);
  return value;
}
</script>
</body>
</html>
